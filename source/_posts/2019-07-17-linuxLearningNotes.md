---
title: linuxLearningNotes
tags: linux
date: 2019-07-17 14:00:37
categories:
---

简单记录一些基本的linux知识。
## linux系统启动过程
**内核引导**：当计算机打开电源后，首先是BIOS开机自检，按照BIOS中设置的启动设备（通常是硬盘）来启动。操作系统接管硬件以后，首先读入 /boot 目录下的内核文件。  
**运行init**：init进程是系统所有进程的起点，首先是需要读取配置文件 /etc/inittab。init进程的一个主要任务是运行开机启动任务（守护进程daemon）。linux为不同的场合分配不同的启动程序，这通常叫做`运行级别`(runlevel)。runlevel有7个(0-6),其中0是关机，6是重启，5是图形界面。
**系统初始化**：在init的配置文件中有这么一行： si::sysinit:/etc/rc.d/rc.sysinit　它调用执行了/etc/rc.d/rc.sysinit，而rc.sysinit是一个bash shell的脚本，它主要是完成一些系统初始化的工作，rc.sysinit是每一个运行级别都要首先运行的重要脚本。它主要完成的工作有：激活交换分区，检查磁盘，加载硬件模块以及其它一些需要优先执行任务。
**建立终端**：rc执行完毕后，返回init。这时基本系统环境已经设置好了，各种守护进程也已经启动了。init接下来会打开6个终端，以便用户登录系统。默认进入图形界面，可以通过`ctrl+alt+F1~F6`切换到命令窗口，`ctrl+alt+F7`回到图形界面。
**用户登录系统**：根据不同方式：命令行，ssh，图形界面，向login验证程序输入信息，登录系统。  

  ![linux系统启动过程](https://blog-1259332958.cos.ap-chengdu.myqcloud.com/linuxLearningNotes/linuxStart.png "图片来自菜鸟教程")  

## linux系统目录结构
树状目录结构

![linux系统目录结构树](https://blog-1259332958.cos.ap-chengdu.myqcloud.com/linuxLearningNotes/linuxDirTree.jpg "图片来自菜鸟教程")

- **/bin**:bin是Binary的缩写, 这个目录存放着最经常使用的命令。
- **/boot**:这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。
- **/dev**:dev是Device(设备)的缩写, 该目录下存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。
- **/etc**:这个目录用来存放所有的系统管理所需要的配置文件和子目录。
- **/home**:用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。
- **/lib**:这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。
- **/lost+found**:这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。
- **/media**:linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。
- **/mnt**:系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。
- **/opt**:这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。
- **/proc**:这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器.`echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all`
- **/root**:该目录为系统管理员，也称作超级权限者的用户主目录。
- **/sbin**:s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。
- **/selinux**:这个目录是Redhat/CentOS所特有的目录，Selinux是一个安全机制，类似于windows的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。
- **/srv**:该目录存放一些服务启动之后需要提取的数据。
- **/sys**:这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs 。sysfs文件系统集成了下面3种文件系统的信息：针对进程信息的proc文件系统、针对设备的devfs文件系统以及针对伪终端的devpts文件系统。该文件系统是内核设备树的一个直观反映。当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。
- **/tmp**:这个目录是用来存放一些临时文件的。
- **/usr**:这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。
- **/usr/bin**:系统用户使用的应用程序。
- **/usr/sbin**:超级用户使用的比较高级的管理程序和系统守护程序。
- **/usr/src**:内核源代码默认的放置目录。
- **/var**:这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。
- **/run**:是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。

在 Linux 系统中，有几个目录是比较重要的，平时需要注意不要误删除或者随意更改内部文件。
**/etc：** 上边也提到了，这个是系统中的配置文件，如果你更改了该目录下的某个文件可能会导致系统不能启动。
**/bin,/sbin,/usr/bin,/usr/sbin:** 这是系统预设的执行文件的放置目录，比如 ls 就是在/bin/ls 目录下的。
值得提出的是，/bin, /usr/bin 是给系统用户使用的指令（除root外的通用户），而/sbin, /usr/sbin 则是给root使用的指令。
**/var：** 这是一个非常重要的目录，系统上跑了很多程序，那么每个程序都会有相应的日志产生，而这些日志就被记录到这个目录下，具体在/var/log 目录下，另外mail的预设放置也是在这里。
## linux文件基本属性
### 文件属主与属组
对于文件来说，它都有一个特定的所有者(user)，也就是对该文件具有所有权的用户。同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。文件所有者以外的用户又可以分为文件所有者的同组用户(group)和其他用户(others)。因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。
### 基本属性
使用`ll`或者`ls -l`命令查看文件或者文件夹的属性  

![文件基本属性查看](https://blog-1259332958.cos.ap-chengdu.myqcloud.com/linuxLearningNotes/ls-l.png "文件基本属性查看")  

其中，第一部分就是文件的基本属性，由10个字符组成：

![文件基本属性](https://blog-1259332958.cos.ap-chengdu.myqcloud.com/linuxLearningNotes/fileProperty.png "文件基本属性")   

第一个字符，代表的文件类型：
- `d`：目录
- `-`：文件
- `l`：链接文档(link file)
- `b`：装置文件里面的可供储存的接口设备(可随机存取装置)
- `c`：装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)

后面分别是不同用户的权限，权限包括三种：[ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号[ - ]而已。

### 更改文件属性
1. **chgrp**:更改文件属组
语法：
```
chgrp [-R] 属组名 文件名
```
参数选项：
- -R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。

2. **chown**:更改文件属主，也可以同时更改文件属组
语法：
```
chown [–R] 属主名 文件名
chown [-R] 属主名：属组名 文件名
```

3. **chmod**:更改文件9个属性
两种设置方式，一种是将rwx与数字对应，通过设置数字来设定对应权限；一种是通过对特定用户对应的符号来单独设定权限。
**数字语法**：
```
chmod [-R] xyz 文件或目录
```
参数选项：
- xyz：三个用户组对应的数字权限
- -R：进行递归(recursive)的持续变更，亦即连同次目录下的所有文件都会变更
各权限数字对应表如下：
| 方式 | 数字 |
| ---- | ---- |
| r    | 4    |
| w    | 2    |
| x    | 1    |


**示例**
当我们要将文件`file`权限设置为 [-rwxrwx---] 时，因为
- owner = rwx = 4+2+1 = 7
- group = rwx = 4+2+1 = 7
- others= --- = 0+0+0 = 0

所以我们使用命令：
```
$ chmod 770 files目录
```

**符号类型改变文件权限语法**  
主要对照下表

|            |           |            |             |          |
| ---------- | --------- | ---------- | ----------- | -------- |
| 用户类型   | u（user） | g（group） | o（others） | a（all） |
| 操作方法   | +（加入） | -（出去）  | =（设定）   |          |
| 可操作对象 | r         | w          | x           |          |


示例：
```
$ chmod u=rwx,g=rw,o=r file #对文件file的不同用户分别修改权限
$ chmod g+x file #组内用户增加执行权限
```

## linux文件与目录管理  
这个基本上每天都能用到，太基础了。
首先是了解几个符号：
- .:当前目录
- ..：父目录
- ~：用户目录，一般是/home/username/

借助上面的符号可以使用**相对路径**，否则，称之为**绝对路径**，如`/home/username/`.
### 处理目录的常用命令
#### ls（列出目录）
```
$ ls [可选参数] [目录或者文件]
```

常用三个参数：
 - -a ：全部的文件，连同隐藏档( 开头为 . 的文件) 一起列出来；
 - -d ：仅列出目录本身，而不是列出目录内的文件数据；
 - -l ：长数据串列出，包含文件的属性与权限等等数据；

#### cd (切换目录)
cd是Change Directory的缩写，这是用来变换工作目录的命令。
```
 $ cd [相对路径或绝对路径]
```

#### pwd (显示目前所在的目录)
pwd 是 Print Working Directory 的缩写，也就是显示目前所在目录的命令。
```
$ pwd [-P]
```

参数：
- -P ：显示出确实的路径，而非使用连结 (link) 路径。(有的时候目录是连接目录)

####　mkdir (创建新目录)
mkdir (make directory)
```
$ mkdir [-mp] 目录名称
```


参数：
- -p ：帮助你直接将所需要的目录(包含上一级目录)递归创建起来！
- -m ：配置文件的权限喔！直接配置，而不是看默认权限 (umask)

```
$ mkdir -p test1/test2/test3/test4
$  mkdir -m 711 test5
```

#### rmdir (删除空的目录)
```
 $ rmdir [-p] 目录名称
```

参数：
- -p ：连同上一级『空的』目录也一起删除

#### cp (复制文件或目录)  

```
$ cp [-adfilprsu] 来源档(source) 目标档(destination)
$ cp [options] source1 source2 source3 .... directory
```

常用参数：
- -a：相当於 -pdr 的意思，至於 pdr 请参考下列说明；(常用)
- -d：若来源档为连结档的属性(link file)，则复制连结档属性而非文件本身；
- -f：为强制(force)的意思，若目标文件已经存在且无法开启，则移除后再尝试一次；
- -i：若目标档(destination)已经存在时，在覆盖时会先询问动作的进行(常用)
- -l：进行硬式连结(hard link)的连结档创建，而非复制文件本身；
- -p：连同文件的属性一起复制过去，而非使用默认属性(备份常用)；
- -r：递归持续复制，用於目录的复制行为；(常用)
- -s：复制成为符号连结档 (symbolic link)，亦即『捷径』文件；
- -u：若 destination 比 source 旧才升级 destination ！

#### rm (移除文件或目录)

```
 $  rm [-fir] 文件或目录
```

参数：
- -f ：就是 force 的意思，忽略不存在的文件，不会出现警告信息；
- -i ：互动模式，在删除前会询问使用者是否动作
- -r ：递归删除啊！最常用在目录的删除了！这是非常危险的选项！！！

#### mv (移动文件与目录，或修改名称)
```
$ mv [-fiu] source destination
$ mv [options] source1 source2 source3 .... directory
```
参数：
- -f ：force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；
- -i ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！
- -u ：若目标文件已经存在，且 source 比较新，才会升级 (update)  

```
$ mv filename0 filename1 #重命名
```

### 查看内容常用命令
Linux系统中使用以下命令来查看文件的内容：
- cat  由第一行开始显示文件内容
- tac  从最后一行开始显示，可以看出 tac 是 cat 的倒著写！
- nl   显示的时候，顺道输出行号！
- more 一页一页的显示文件内容
- less 与 more 类似，但是比 more 更好的是，他可以往前翻页！
- head 只看头几行
- tail 只看尾巴几行


## linux用户与用户组管理
实现用户账户的管理，要完成的工作主要有如下几个方面：
- 用户账号的添加、删除与修改。
- 用户口令的管理。
- 用户组的管理。

### Linux系统用户账号的管理
#### 添加新的用户账号
增加用户账号就是在/etc/passwd文件中为新用户增加一条记录，同时更新其他系统文件如/etc/shadow, /etc/group等。
Linux提供了集成的系统管理工具userconf，它可以用来对用户账号进行统一管理。
```
$ useradd 选项 用户名
```

参数：
- -c comment 指定一段注释性描述。
- -d 目录 指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录
- -g 用户组 指定用户所属的用户组。
- -G 用户组，用户组 指定用户所属的附加组。
- -s Shell文件 指定用户的登录Shell。
- -u 用户号 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。

示例：
```
$ useradd –d /usr/sam -m sam
# 此命令创建了一个用户sam，其中-d和-m选项用来为登录名sam产生一个主目录/usr/sam（/usr为默认的用户主目录所在的父目录）。
$ useradd -s /bin/sh -g group –G adm,root gem
# 此命令新建了一个用户gem，该用户的登录Shell是 /bin/sh，它属于group用户组，同时又属于adm和root用户组，其中group用户组是其主组。
```

#### 删除帐号
如果一个用户的账号不再使用，可以从系统中删除。删除用户账号就是要将/etc/passwd等系统文件中的该用户记录删除，必要时还删除用户的主目录。
删除一个已有的用户账号使用userdel命令，其格式如下：
```
$ userdel 选项 用户名 #常用的选项是 -r，它的作用是把用户的主目录一起删除。
```

#### 修改帐号
改用户账号就是根据实际情况更改用户的有关属性，如用户号、主目录、用户组、登录Shell等。
修改已有用户的信息使用usermod命令，其格式如下：
```
$ usermod 选项 用户名
```
 常用的选项包括-c, -d, -m, -g, -G, -s, -u以及-o等，这些选项的意义与useradd命令中的选项一样，可以为用户指定新的资源值。
另外，有些系统可以使用选项：-l 新用户名.
这个选项指定一个新的账号，即将原来的用户名改为新的用户名。
示例：
```
$ usermod -s /bin/ksh -d /home/z –g developer sam
# 此命令将用户sam的登录Shell修改为ksh，主目录改为/home/z，用户组改为developer。
```

#### 用户口令的管理
用户管理的一项重要内容是用户口令的管理。用户账号刚创建时没有口令，但是被系统锁定，无法使用，必须为其指定口令后才可以使用，即使是指定空口令。
指定和修改用户口令的Shell命令是passwd。超级用户可以为自己和其他用户指定口令，普通用户只能用它修改自己的口令。命令的格式为：
```
$ passwd 选项 用户名
```

参数：
- -l 锁定口令，即禁用账号。
- -u 口令解锁。
- -d 使账号无口令。
- -f 强迫用户下次登录时修改口令。

### 用户组的管理
#### 增加用户组
```
$ groupadd 选项 用户组
```

参数：

- -g GID 指定新用户组的组标识号（GID）。
- -o 一般与-g选项同时使用，表示新用户组的GID可以与系统已有用户组的GID相同。


#### 删除用户组
```
$ groupdel 用户组
```
#### 修改用户组属性
```
$ groupmod 选项 用户组
```

参数：

- -g GID 指定新用户组的组标识号（GID）。
- -o 一般与-g选项同时使用，表示新用户组的GID可以与系统已有用户组的GID相同。
- -n新用户组 将用户组的名字改为新名字

#### 切换用户组
如果一个用户同时属于多个用户组，那么用户可以在用户组之间切换，以便具有其他用户组的权限。用户可以在登录后，使用命令newgrp切换到其他用户组，这个命令的参数就是目的用户组。如：
```
$ newgrp root #将当前用户切换到root用户组
```

### 几个系统文件
完成用户管理的工作有许多种方法，但是每一种方法实际上都是对有关的系统文件进行修改。
与用户和用户组相关的信息都存放在一些系统文件中，这些文件包括/etc/passwd, /etc/shadow, /etc/group等。
- **/etc/passwd**:Linux系统中的每个用户都在/etc/passwd文件中有一个对应的记录行，它记录了这个用户的一些基本属性。包括`用户名，口令，用户标识号，组标识号，注释性描述，主目录，登录Shell`等。
- **etc/shadow**:由于/etc/passwd文件是所有用户都可读的，如果用户的密码太简单或规律比较明显的话，一台普通的计算机就能够很容易地将它破解，因此对安全性要求较高的Linux系统都把加密后的口令字分离出来，单独存放在一个文件中，这个文件是/etc/shadow文件。 有超级用户才拥有该文件读权限，这就保证了用户密码的安全性。主要包括`登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志`
- **/etc/group**:用户组的所有信息都存放在/etc/group文件中,主要包括`组名:口令:组标识号:组内用户列表`.当一个用户同时是多个组中的成员时，在/etc/passwd文件中记录的是用户所属的主组，也就是登录时所属的默认组，而其他组称为附加组。用户要访问属于附加组的文件时，必须首先使用newgrp命令使自己成为所要访问的组中的成员。

### 批量添加账户
有的时候需要批量添加用户，肯能是好几十个，这肯定不能一个个添加，可以考虑[批量添加](https://www.runoob.com/linux/linux-user-manage.html)。

## linux磁盘管理  
Linux磁盘管理常用三个命令为df、du和fdisk。

- df：列出文件系统的整体磁盘使用量
- du：检查磁盘空间使用量
- fdisk：用于磁盘分区

### df 检查文件系统的磁盘空间占用情况
df 命令用来检查文件系统的磁盘空间占用情况。可以利用该命令来获取硬盘被占用了多少空间，目前还剩下多少空间等信息。
语法：
```
$df [-ahikHTm] [目录或文件名]
```

参数：

- -a ：列出所有的文件系统，包括系统特有的 /proc 等文件系统；
- -k ：以 KBytes 的容量显示各文件系统；
- -m ：以 MBytes 的容量显示各文件系统；
- -h ：以人们较易阅读的 GBytes, MBytes, KBytes 等格式自行显示；
- -H ：以 M=1000K 取代 M=1024K 的进位方式；
- -T ：显示文件系统类型, 连同该 partition 的 filesystem 名称 (例如 ext3) 也列出；
- -i ：不用硬盘容量，而以 inode 的数量来显示

示例：
```
$ df     # 将系统所有文件提醒列出来
$ df -h  # 将结果用易读的方式显示出来
$ df -aT # 将系统内的所有特殊文件格式及名称都列出来
$ df -h /etc # 将 /etc 底下的可用的磁盘容量以易读的容量格式显示
```

### du 查看文件和目录所占用的磁盘空间
Linux du命令也是查看使用空间的，但是与df命令不同的是Linux du命令是对文件和目录磁盘使用的空间的查看
语法：
```
$ du [-ahskm] 文件或目录名称
```
参数：

- -a ：列出所有的文件与目录容量，因为默认仅统计目录底下的文件量而已。
- -h ：以人们较易读的容量格式 (G/M) 显示；
- -s ：列出总量而已，而不列出每个各别的目录占用容量；
- -S ：不包括子目录下的总计，与 -s 有点差别。
- -k ：以 KBytes 列出容量显示；
- -m ：以 MBytes 列出容量显示；

示例：
```
$ du #列出所有目录的空间占用情况
$ du -a #列出文件和目录的空间占用情况
$ du -sm /* #检查根目录底下每个目录所占用的容量
```

### fdisk 磁盘分区操作
fdisk 是 Linux 的磁盘分区表操作工具。
```
fdisk [-l] 装置名称
```

参数：
- -l ：输出后面接的装置所有的分区内容。若仅有 fdisk -l 时， 则系统将会把整个系统内能够搜寻到的装置的分区均列出来。

例子：
```
# 列出所有分区信息
$ fdisk -l
# 找出你系统中的根目录所在磁盘，并查阅该硬盘内的相关信息
$ df / # 找到自己磁盘目录
$ fdisk  [磁盘目录]
```
### mkfs 磁盘格式化
mkfs 即 make filesystem
```
$ mkfs [-t 文件系统格式] 装置文件名
```

参数：
- -t ：可以接文件系统格式，例如 ext3, ext2, vfat 等(系统有支持才会生效)

```
$  mkfs -t ext3 /dev/hdc6 # 将分区 /dev/hdc6（可指定你自己的分区） 格式化为 ext3 文件系统
```

### fsck  磁盘检验
fsck（file system check）用来检查和维护不一致的文件系统。
若系统掉电或磁盘发生问题，可利用fsck命令对文件系统进行检查。
```
$ fsck [-t 文件系统] [-ACay] 装置名称
```

参数：

- -t : 给定档案系统的型式，若在 /etc/fstab 中已有定义或 kernel 本身已支援的则不需加上此参数
- -s : 依序一个一个地执行 fsck 的指令来检查
- -A : 对/etc/fstab 中所有列出来的 分区（partition）做检查
- -C : 显示完整的检查进度
- -d : 打印出 e2fsck 的 debug 结果
- -p : 同时有 -A 条件时，同时有多个 fsck 的检查一起执行
- -R : 同时有 -A 条件时，省略 / 不检查
- -V : 详细显示模式
- -a : 如果检查有错则自动修复
- -r : 如果检查有错则由使用者回答是否修复
- -y : 选项指定检测每个文件是自动输入yes，在不确定那些是不正常的时候，可以执行 # fsck -y 全部检查修复。

例子：
```
$ fsck -C -f -t ext3 /dev/hdc6  #强制检测 /dev/hdc6 分区:
```

#### 磁盘挂载与卸除  
Linux 的磁盘挂载使用 mount 命令，卸载使用 umount 命令。
```
$ mount [-t 文件系统] [-L Label名] [-o 额外选项] [-n]  装置文件名  挂载点
$ umount [-fn] 装置文件名或挂载点
```

参数：
- -f ：强制卸除！可用在类似网络文件系统 (NFS) 无法读取到的情况下；
- -n ：不升级 /etc/mtab 情况下卸除。

例子：
```
# 用默认的方式，将刚刚创建的 /dev/hdc6 挂载到 /mnt/hdc6 上面！
$ mkdir /mnt/hdc6
$ mount /dev/hdc6 /mnt/hdc6
$ [root@www ~]# umount /dev/hdc6 #卸载/dev/hdc6
```

---
## 参考文献
1. [linux教程-菜鸟教程](https://www.runoob.com/linux/linux-tutorial.html)
